language: go
sudo: false
go:
  - "1.10.x"
env:
  global:
  - TEST_TIMEOUT_SCALE=10
before_install:
  - >-
    openssl aes-256-cbc 
    -K $encrypted_eb46e5b4becc_key 
    -iv $encrypted_eb46e5b4becc_iv 
    -in .travis/github_deploy_key.enc 
    -out github_deploy_key 
    -d
  - chmod 600 github_deploy_key
  - eval $(ssh-agent -s)
  - ssh-add github_deploy_key
install:
  - go get -v github.com/Masterminds/glide
  - cd $GOPATH/src/github.com/Masterminds/glide && go install && cd -
  - glide install
  - go install ./vendor/github.com/mattn/goveralls
script:
  - go test -race -v
after_success:
  - goveralls -service=travis-ci
deploy:
  provider: releases
  skip_cleanup: true
  file_glob: true
  file: builds/*
  on:
    tags: true
before_deploy: 
  - ./build.sh $TRAVIS_TAG